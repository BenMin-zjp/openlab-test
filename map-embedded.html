<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <title>map-embedded</title>
    <!-- 引入 Leaflet -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
</head>

<body>
    <h1>网站嵌入OpenStreetMap的示例：</h1>
    <p>（由于网络环境原因，没有魔法就无法加载，则鼓励使用国内的百度、高德等地图服务）</p>
    <!-- 设置地图的长和宽 -->
    <!-- 全宽、高度为浏览器窗口80%的空盒子 ，方便后面塞地图-->
    <div id="osm-map" style="width: 100%; height: 80vh; margin: 20px 0;"></div>
    <script>
        // 初始化地图
        // 设置地图中心点与缩放级别
        //将刚才的空盒子变为 地图
        // 并且把地图放到山东大学青岛校区附近，缩放到15级（街道）级别
        const map = L.map('osm-map').setView([36.365, 120.684], 15);


        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 19,
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map);
        

        //下面是停车取得相关代码，用于引入文件，划停车区，显示名称与单车辆数
        fetch('file:///C:/Users/13825/Desktop/openlab复试/2.2显示单车/parkingLot.json') //读取文件
            .then(response => response.json()) //转换为 GeoJSON 格式
            .then(geo => L.geoJSON(geo, {
                style: () => ({color: 'blue', weight: 2, fillOpacity: 0.2}), //设置样式,多边形样式，蓝色边框，2像素宽，透明度20%
                onEachFeature: (f,layer) => layer.bindPopup(`名称：${f.properties.name}<br>容量：${f.properties.capacity}辆`)//绑定弹出框，显示停车场名称和单车辆数
            }).addTo(map));

        //下面这些代码用于显示单车
        fetch('file:///C:/Users/13825/Desktop/openlab复试/2.2显示单车/e-bike.json') //读取文件
            .then(response => response.json()) //转换为 GeoJSON 格式
            .then(geo => L.geoJSON(geo, {
                pointToLayer: (f,latlng) => { //换颜色为彩色
                    const b = f.properties.battery; //取出单车电量
                    const color = b > 70 ? 'green' : b > 30 ? 'orange' : 'red'; //根据电量设置颜色,以便让单车电量可视化，让用户用着比较舒服
                    return L.circleMarker(latlng, {
                        radius: 8,  //直径8像素
                        color: 'white',weight: 2 ,//白色边框，宽2像素
                        fillColor: color, fillOpacity: 0.9 ,//按电量填充颜色，透明度90%
                        onEachFeature: (f,layer) => layer.bindPopup(`车牌：${f.properties.plate}<br>电量：${f.properties.battery}%`) //点击显示车辆编号，电量
                    });
                }
            }).addTo(map));
    </script>
</body>

</html>